"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6371],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=c(n),m=i,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||r;return n?a.createElement(h,s(s({ref:t},p),{},{components:n})):a.createElement(h,s({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var c=2;c<r;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},856:function(e,t,n){n.d(t,{Z:function(){return p}});var a=n(4578),i=n(5861),r=n(7855),s=n(7757),o=n.n(s),l=n(7294),c=function(){function e(e,t){void 0===e&&(e="#termynal"),void 0===t&&(t={}),this.container="string"==typeof e?document.querySelector(e):e,this.pfx="data-"+(t.prefix||"ty"),this.originalStartDelay=this.startDelay=t.startDelay||parseFloat(this.container.getAttribute(this.pfx+"-startDelay"))||600,this.originalTypeDelay=this.typeDelay=t.typeDelay||parseFloat(this.container.getAttribute(this.pfx+"-typeDelay"))||90,this.originalLineDelay=this.lineDelay=t.lineDelay||parseFloat(this.container.getAttribute(this.pfx+"-lineDelay"))||1500,this.progressLength=t.progressLength||parseFloat(this.container.getAttribute(this.pfx+"-progressLength"))||40,this.progressChar=t.progressChar||this.container.getAttribute(this.pfx+"-progressChar")||"\u2588",this.progressPercent=t.progressPercent||parseFloat(this.container.getAttribute(this.pfx+"-progressPercent"))||100,this.cursor=t.cursor||this.container.getAttribute(this.pfx+"-cursor")||"\u258b",this.lineData=this.lineDataToElements(t.lineData||[]),this.loadLines(),t.noInit||this.init()}var t=e.prototype;return t.loadLines=function(){var e=this.generateFinish();e.style.visibility="hidden",this.container.appendChild(e),this.lines=Array.from(this.container.querySelectorAll("["+this.pfx+"]")).concat(this.lineData);for(var t=0;t<this.lines.length;t++)this.lines[t].style.visibility="hidden",this.container.appendChild(this.lines[t]);var n=this.generateRestart();n.style.visibility="hidden",this.container.appendChild(n),this.container.setAttribute("data-termynal","")},t.init=function(){var e=getComputedStyle(this.container);this.container.style.width="0px"!==e.width?e.width:void 0,this.container.style.minHeight="0px"!==e.height?e.height:void 0,this.container.setAttribute("data-termynal",""),this.container.innerHTML="";for(var t,n=(0,r.Z)(this.lines);!(t=n()).done;){t.value.style.visibility="visible"}this.start()},t.start=function(){var e=(0,i.Z)(o().mark((function e(){var t,n,a,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.addFinish(),e.next=3,this._wait(this.startDelay);case 3:t=(0,r.Z)(this.lines);case 4:if((n=t()).done){e.next=29;break}if(a=n.value,i=a.getAttribute(this.pfx),s=a.getAttribute(this.pfx+"-delay")||this.lineDelay,"input"!==i){e.next=16;break}return a.setAttribute(this.pfx+"-cursor",this.cursor),e.next=12,this.type(a);case 12:return e.next=14,this._wait(s);case 14:e.next=26;break;case 16:if("progress"!==i){e.next=23;break}return e.next=19,this.progress(a);case 19:return e.next=21,this._wait(s);case 21:e.next=26;break;case 23:return this.container.appendChild(a),e.next=26,this._wait(s);case 26:a.removeAttribute(this.pfx+"-cursor");case 27:e.next=4;break;case 29:this.addRestart(),this.finishElement.style.visibility="hidden",this.lineDelay=this.originalLineDelay,this.typeDelay=this.originalTypeDelay,this.startDelay=this.originalStartDelay;case 34:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.generateRestart=function(){var e=this,t=document.createElement("a");return t.onclick=function(t){t.preventDefault(),e.container.innerHTML="",e.init()},t.href="#",t.setAttribute("data-terminal-control",""),t.innerHTML="restart \u21bb",t},t.generateFinish=function(){var e=this,t=document.createElement("a");return t.onclick=function(t){t.preventDefault(),e.lineDelay=0,e.typeDelay=0,e.startDelay=0},t.href="#",t.setAttribute("data-terminal-control",""),t.innerHTML="fast \u2192",this.finishElement=t,t},t.addRestart=function(){var e=this.generateRestart();this.container.appendChild(e)},t.addFinish=function(){var e=this.generateFinish();this.container.appendChild(e)},t.type=function(){var e=(0,i.Z)(o().mark((function e(t){var n,a,i,r,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.from(t.textContent),t.textContent="",this.container.appendChild(t),a=0,i=n;case 4:if(!(a<i.length)){e.next=13;break}return r=i[a],s=t.getAttribute(this.pfx+"-typeDelay")||this.typeDelay,e.next=9,this._wait(s);case 9:t.textContent+=r;case 10:a++,e.next=4;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.progress=function(){var e=(0,i.Z)(o().mark((function e(t){var n,a,i,r,s,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.getAttribute(this.pfx+"-progressLength")||this.progressLength,a=t.getAttribute(this.pfx+"-progressChar")||this.progressChar,i=a.repeat(n),r=t.getAttribute(this.pfx+"-progressPercent")||this.progressPercent,t.textContent="",this.container.appendChild(t),s=1;case 7:if(!(s<i.length+1)){e.next=17;break}return e.next=10,this._wait(this.typeDelay);case 10:if(l=Math.round(s/i.length*100),t.textContent=i.slice(0,s)+" "+l+"%",!(l>r)){e.next=14;break}return e.abrupt("break",17);case 14:s++,e.next=7;break;case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t._wait=function(e){return new Promise((function(t){return setTimeout(t,e)}))},t.lineDataToElements=function(e){var t=this;return e.map((function(e){var n=document.createElement("div");return n.innerHTML="<span "+t._attributes(e)+">"+(e.value||"")+"</span>",n.firstElementChild}))},t._attributes=function(e){var t="";for(var n in e)"class"!==n?"type"===n?t+=this.pfx+'="'+e[n]+'" ':"value"!==n&&(t+=this.pfx+"-"+n+'="'+e[n]+'" '):t+=" class="+e[n]+" ";return t},e}(),p=function(e){function t(){return e.apply(this,arguments)||this}(0,a.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){new c(this.t,{typeDelay:40,lineDelay:700})},n.render=function(){var e=this;return l.createElement("div",null,l.createElement("div",{"data-terminal":!0,style:this.props.style,ref:function(t){return e.t=t}},this.props.children))},t}(l.Component)},35:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),s=n(856),o=["components"],l={sidebar_position:1,title:"train"},c=void 0,p={unversionedId:"reference-manual/cli/train",id:"reference-manual/cli/train",title:"train",description:"The core syntax of the train command is the following:",source:"@site/docs/reference-manual/cli/train.md",sourceDirName:"reference-manual/cli",slug:"/reference-manual/cli/train",permalink:"/classy/docs/reference-manual/cli/train",editUrl:"https://github.com/sunglasses-ai/classy/edit/main/docs/docs/reference-manual/cli/train.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"train"},sidebar:"tutorialSidebar",previous:{title:"Custom Evaluation Metric",permalink:"/classy/docs/getting-started/customizing-things/custom-metric"},next:{title:"predict",permalink:"/classy/docs/reference-manual/cli/predict"}},d={},u=[{value:"Visualizing your Configuration",id:"visualizing-your-configuration",level:2}],m={toc:u};function h(e){var t=e.components,l=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The core syntax of the train command is the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'classy train\n    <task>                # any in {sequence,token,sentence-pair}\n    <path-to-dataset>     # path to your dataset\n    -n <exp-name>         # name you want to give to your model\n    -d <device>           # device on which to train ("cpu" for cpu, or device number for gpu)\n    [--print]\n')),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If a device is not provided explicitly, ",(0,r.kt)("inlineCode",{parentName:"p"},"classy")," will search and use a gpu if present, resorting otherwise to cpu."))),(0,r.kt)("p",null,"Your model and experiment data will be saved in ",(0,r.kt)("em",{parentName:"p"},"experiments/"),"<","exp-name",">",(0,r.kt)("em",{parentName:"p"},"/current-day/current-time/"),"."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you want to transfer your model to a different pc, the simplest way is to transfer the entire\n",(0,r.kt)("em",{parentName:"p"},"experiments/"),"<","exp-name",">",(0,r.kt)("em",{parentName:"p"},"/current-day/current-time/")," folder. However, multiple checkpoints, i.e. the model at different\nmoments in the training, might be present in the ",(0,r.kt)("em",{parentName:"p"},"checkpoints/")," folder; to speed up the transfer, you might want to\nconsider moving only one of them, for instance the best one, ",(0,r.kt)("em",{parentName:"p"},"checkpoints/best.ckpt"),"."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note")," that ",(0,r.kt)("em",{parentName:"p"},"<","path-to-dataset",">")," is a bit of a special parameter and can be either:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"a ",(0,r.kt)("strong",{parentName:"p"},"folder"),", or, actually, a ",(0,r.kt)("em",{parentName:"p"},"ML-ready")," folder: that is, it must contain a training file, named ",(0,r.kt)("em",{parentName:"p"},"train.#"),"\n(# denotes a classy supported extension), and, optionally, a validation file and a test file, ",(0,r.kt)("em",{parentName:"p"},"validation.#")," and ",(0,r.kt)("em",{parentName:"p"},"test.#"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"a ",(0,r.kt)("strong",{parentName:"p"},"file"),": classy uses the file provided to automatically generate an ML-ready folder for you, storing it in the\n",(0,r.kt)("em",{parentName:"p"},"data/")," folder inside the current experiment")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"a ",(0,r.kt)("strong",{parentName:"p"},"yaml file"),": classy reads the yaml file and infer the datasets involved in the training process from it. It should be organized as follows:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'# Optional parameter that tells classy which is your favourite format.\n# If classy has to save something, it will save it in the format you specify,\n#  using the corresponding DataDriver.\nmain_data_driver: "json"\n\n# You can specify a split using a dictionary path -> extension\n#  that tells classy the dataset involved and which DataDriver\n#  to use for each dataset.\ntrain_dataset:\n  "first-train-dataset-path.tsv": "tsv"\n  "second-train-dataset-path.json": "my-special-format"\n\n# You can also specify a split as a list of paths, and the DataDriver\n#  to use for each dataset will be inferred from the extension.\nvalidation_dataset:\n  - "fist-validation-dataset.tsv"\n  - "second-validation-dataset.tsv"\n\n# And finally, you can specify a split as single path\ntest_dataset: "test-dataset.json"\n')))),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"In both ",(0,r.kt)("em",{parentName:"p"},"folder")," and ",(0,r.kt)("em",{parentName:"p"},"yaml file")," cases, if the validation dataset is not specified, classy automatically generates it by reserving some samples\nfrom the training file: the new training and validation files are saved in the ",(0,r.kt)("em",{parentName:"p"},"data/")," folder inside the current experiment.\nThis does not hold for the test set and, if not present, classy ",(0,r.kt)("strong",{parentName:"p"},"will not")," create it."))),(0,r.kt)(s.Z,{mdxType:"ReactTermynal"},(0,r.kt)("span",{"data-ty":"input"},"classy train sequence data/sequence-dataset -n sequence-example"),(0,r.kt)("span",{"data-ty":"progress"}),(0,r.kt)("span",{"data-ty":!0},"Training completed"),(0,r.kt)("span",{"data-ty":"input"},"ls experiments"),(0,r.kt)("span",{"data-ty":!0},"sequence-sample/"),(0,r.kt)("span",{"data-ty":"input"},"tree -L 2 sequence-example"),(0,r.kt)("span",{className:"data-ty-treefix","data-ty":!0},"experiments/sequence-example/<day>/<time>/",(0,r.kt)("div",null,"\u251c\u2500\u2500 .hydra\n          \u2502   \u2514\u2500\u2500 config.yaml\n          \u251c\u2500\u2500 checkpoints\n          \u2502   \u251c\u2500\u2500 best.ckpt\n          \u2502   \u251c\u2500\u2500 epoch=00-val_loss=0.51.ckpt\n          \u2502   \u2514\u2500\u2500 last.ckpt\n          \u251c\u2500\u2500 data\n          \u2502   \u251c\u2500\u2500 train.shuffled.tsv\n          \u2502   \u2514\u2500\u2500 validation.tsv\n          \u2514\u2500\u2500 ...\n        ".split("\n").map((function(e,t){return(0,r.kt)("p",{key:t,style:{lineHeight:"1.0"}},e)}))))),(0,r.kt)("p",null),(0,r.kt)("p",null,"For all CLI commands that involve using a trained model, you can use 4 ways to specify it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# the <exp-name> you used at training time (classy will search in the experiments/ folder and use the latest best.ckpt)\nclassy <cmd> sequence-example ...\n# path to model folder\nclassy <cmd> experiments/sequence-example/ ...\n# path to specific model experiment <day>/<time>\nclassy <cmd> experiments/sequence-example/<day>/<time> ...\n# path to checkpoint inside a model experiment folder\nclassy <cmd> experiments/sequence-example/<day>/<time>/checkpoints/epoch=00-val_loss=0.51.ckpt\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"For all CLI commands, you can execute ",(0,r.kt)("inlineCode",{parentName:"p"},"classy <command> -h")," for additional information and parameters."))),(0,r.kt)("h2",{id:"visualizing-your-configuration"},"Visualizing your Configuration"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"classy train")," has an option that lets you visualize the full materialized configuration in your terminal, showing you\nwhere each component comes from (including overridden configuration groups, overrides, profiles, etc.).\nTo print it, simply append ",(0,r.kt)("inlineCode",{parentName:"p"},"--print")," to your current ",(0,r.kt)("inlineCode",{parentName:"p"},"classy train")," command!"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Classy Train Print - Token",src:n(50).Z,width:"2416",height:"1490"})))}h.isMDXComponent=!0},50:function(e,t,n){t.Z=n.p+"assets/images/classy-train-print-tok-b5a757bdb763b121178cee5774958d41.png"}}]);